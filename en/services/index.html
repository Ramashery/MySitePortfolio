<!DOCTYPE html>
<!-- Язык будет установлен динамически -->
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- SEO-теги будут сгенерированы динамически -->
    <title>Our Services | Digital Craft</title>
    
    <script>
      (function(){
        var redirect = sessionStorage.redirect;
        delete sessionStorage.redirect;
        if (redirect && redirect != location.pathname) {
          history.replaceState(null, null, (location.pathname.endsWith('/') ? location.pathname.slice(0, -1) : location.pathname) + redirect);
        }
      })();
    </script>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&amp;display=swap" rel="stylesheet">
    
    <style>
        /* --- Стили полностью скопированы с главной страницы --- */
        :root {
            --color-bg: #030409;
            --color-text: #FFFFFF;
            --color-accent: #b8d8e8;
            --color-card: rgba(25, 29, 45, 0.4);
            --color-border: rgba(184, 216, 232, 0.2);
            --font-main: 'Inter', sans-serif;
            --header-height: 80px;
        }
        body { margin: 0; padding: 0; font-family: var(--font-main); background-color: var(--color-bg); color: var(--color-text); -webkit-font-smoothing: antialiased; overflow-x: hidden; line-height: 1.6; }
        h1, h2, h3, h4 { font-weight: 600; letter-spacing: 0.5px; }
        h1 { font-size: clamp(2.5rem, 8vw, 4.5rem); margin-bottom: 40px; }
        h2 { font-size: clamp(1.8rem, 1.5rem + 1.5vw, 2.5rem); }
        a { color: var(--color-accent); text-decoration: none; }
        #loader { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--color-bg); display: flex; justify-content: center; align-items: center; z-index: 10000; transition: opacity 0.5s ease-out; }
        #loader.hidden { opacity: 0; pointer-events: none; }
        .spinner { width: 50px; height: 50px; border: 3px solid var(--color-accent); border-radius: 50%; border-top-color: transparent; animation: spin 1s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
        #custom-background-iframe { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; border: none; z-index: 0; display: none; }
        main { position: relative; z-index: 2; max-width: 1200px; margin: 0 auto; padding: 100px 30px; }
        @keyframes fadeInUp { to { opacity: 1; transform: translateY(0); } }
        .fade-in-up { opacity: 0; transform: translateY(20px); animation: fadeInUp 1s forwards; }
        section { margin-bottom: 120px; perspective: 1000px; }
        .floating-item { opacity: 0.5; transform: translateY(60px); transition: transform 1.2s cubic-bezier(0.2, 0.8, 0.2, 1), opacity 1.2s cubic-bezier(0.2, 0.8, 0.2, 1); }
        .floating-item.is-visible { opacity: 1; transform: translateY(0); }
        .floating-item.is-above { opacity: 0.5; transform: translateY(-60px); }
        .animated-container { opacity: 0; transform: translateY(20px); }
        .item-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 30px; margin-top: 40px; }
        .item-card { display: flex; flex-direction: column; background: var(--color-card); border: 1px solid var(--color-border); border-radius: 8px; overflow: hidden; transition: all 0.4s cubic-bezier(0.25, 0.8, 0.25, 1); }
        .item-card:hover { transform: translateY(-10px) scale(1.02) !important; border-color: var(--color-accent); box-shadow: 0 10px 30px rgba(184, 216, 232, 0.3); }
        .item-card__image { aspect-ratio: 4 / 3; background: linear-gradient(135deg, rgba(184, 216, 232, 0.1), rgba(25, 29, 45, 0.7)); background-size: cover; background-position: center; }
        .item-card__content { padding: 25px; }
        .item-card h3 { margin: 0 0 10px; font-size: 1.3rem; transition: color 0.3s ease-out; color: var(--color-text); }
        .item-card:hover h3 { color: var(--color-accent); }
        .item-card .card-subtitle { display: block; margin-bottom: 15px; opacity: 0.8; font-size: 0.9rem; color: var(--color-text); }
        .item-card p { margin: 0; font-size: 1.05rem; opacity: 0.9; color: var(--color-text); }
        .menu-toggle { position: fixed; top: 30px; right: 30px; z-index: 1000; background: transparent; border: none; padding: 0; cursor: pointer; width: 30px; height: 24px; display: flex; flex-direction: column; justify-content: space-between; transition: transform 0.4s; }
        .menu-toggle:hover { transform: scale(1.1); }
        .menu-toggle .bar { background: #FFFFFF; height: 2px; width: 100%; transition: all 0.4s cubic-bezier(0.165, 0.84, 0.44, 1); transform-origin: right; }
        .menu-toggle.is-active .bar:nth-child(1) { transform: translateY(11px) rotate(-45deg); background: var(--color-accent); }
        .menu-toggle.is-active .bar:nth-child(2) { opacity: 0; }
        .menu-toggle.is-active .bar:nth-child(3) { transform: translateY(-11px) rotate(45deg); background: var(--color-accent); }
        .nav-overlay { position: fixed; top: 0; right: -100%; width: 400px; height: 100vh; background: var(--color-card); backdrop-filter: blur(10px); z-index: 999; transition: right 0.6s cubic-bezier(0.77, 0, 0.175, 1); overflow: hidden; }
        .nav-overlay.is-active { right: 0; }
        .nav-menu { padding: 100px 40px; list-style: none; margin: 0; }
        .nav-menu li { margin-bottom: 25px; opacity: 0; transform: translateX(30px); transition: all 0.4s ease-out; }
        .nav-overlay.is-active .nav-menu li { opacity: 1; transform: translateX(0); }
        .nav-menu li:nth-child(1) { transition-delay: 0.1s; } .nav-menu li:nth-child(2) { transition-delay: 0.2s; } .nav-menu li:nth-child(3) { transition-delay: 0.3s; }
        .nav-menu a { color: var(--color-text); font-size: 1.8rem; position: relative; padding-bottom: 5px; transition: all 0.3s ease-out; }
        .nav-menu a:hover { color: var(--color-accent); transform: translateX(5px); }
        .nav-menu a::after { content: ''; position: absolute; bottom: 0; left: 0; width: 0; height: 1px; background: var(--color-accent); transition: width 0.4s; }
        .nav-menu a:hover::after { width: 100%; }
        .site-footer { position: relative; z-index: 2; text-align: center; padding: 20px 30px; font-size: 0.9rem; color: rgba(255, 255, 255, 0.5); cursor: pointer; user-select: none; -webkit-user-select: none; }
        #admin-panel { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(3, 4, 9, 0.95); z-index: 10000; display: none; overflow-y: auto; backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); } #admin-panel.active { display: block; } .admin-container { display: flex; min-height: 100vh; } .admin-sidebar { width: 250px; background: rgba(25, 29, 45, 0.8); padding: 30px; border-right: 1px solid var(--color-border); position: sticky; top: 0; height: 100vh; } .admin-sidebar h3 { margin-top: 0; } .admin-sidebar ul { list-style: none; padding: 0; } .admin-sidebar ul li { margin-bottom: 10px; } .admin-content { flex: 1; padding: 40px; } .admin-tabs { list-style: none; padding: 0; } .admin-tab { padding: 10px 0; cursor: pointer; transition: all 0.3s; } .admin-tab.active { color: var(--color-accent); font-weight: bold; } .admin-tab:not(.active):hover { color: var(--color-accent); transform: translateX(5px); } .tab-content { display: none; } .tab-content.active { display: block; } #admin-close-btn { position: absolute; top: 25px; right: 25px; background: none; border: none; color: var(--color-text); font-size: 2rem; cursor: pointer; transition: all 0.3s; line-height: 1; } #admin-close-btn:hover { color: var(--color-accent); transform: rotate(90deg); } .admin-section-header { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--color-border); padding-bottom: 15px; margin-bottom: 30px; } .admin-item { background: var(--color-card); padding: 20px; border-radius: 8px; border: 1px solid var(--color-border); margin-bottom: 20px; } .admin-item-content { display: grid; grid-template-columns: 1fr; gap: 15px; } .admin-item-content h4 { margin: 15px 0 0; border-top: 1px solid var(--color-border); padding-top: 15px; color: var(--color-accent); } .admin-item label { font-size: 0.9rem; opacity: 0.8; margin-bottom: -10px; } .admin-item input, .admin-item textarea, .admin-item select { width: 100%; background: rgba(0,0,0,0.2); border: 1px solid var(--color-border); color: var(--color-text); padding: 10px; border-radius: 4px; font-family: inherit; font-size: 1rem; transition: all 0.3s; box-sizing: border-box; } .admin-item input:disabled, .admin-item textarea:disabled, .admin-item select:disabled { background: transparent; border-color: transparent; color: var(--color-text); padding-left: 0; -webkit-appearance: none; -moz-appearance: none; appearance: none; } .admin-item input:focus, .admin-item textarea:focus, .admin-item select:focus { border-color: var(--color-accent); background: rgba(0,0,0,0.4); } .admin-item textarea { min-height: 80px; resize: vertical; line-height: 1.6; } .admin-item-actions { display: flex; gap: 10px; margin-top: 20px; justify-content: flex-end; } .admin-btn { padding: 8px 16px; border: 1px solid var(--color-accent); background: rgba(184, 216, 232, 0.1); color: var(--color-accent); border-radius: 4px; cursor: pointer; transition: all 0.3s; } .admin-btn:hover { background: rgba(184, 216, 232, 0.3); color: var(--color-text); } .admin-btn.delete-btn { border-color: #e57373; color: #e57373; } .admin-btn.delete-btn:hover { background: rgba(229, 115, 115, 0.3); color: var(--color-text); } .admin-btn.save-btn { display: none; } .admin-item.is-editing .edit-btn { display: none; } .admin-item.is-editing .save-btn { display: inline-block; } .admin-item.is-editing input, .admin-item.is-editing textarea, .admin-item.is-editing select { padding-left: 10px; } .admin-item.is-editing select { -webkit-appearance: menulist; -moz-appearance: menulist; appearance: menulist; }
        .mobile-sliders-container { display: none; }
        .language-slider-block { margin-bottom: 30px; }
        .cross-fade-slider { position: relative; -webkit-tap-highlight-color: transparent; transition: height 0.5s ease-in-out; }
        .cross-fade-slider .item-card { position: absolute; top: 0; left: 0; width: 100%; opacity: 0; z-index: 1; pointer-events: none; transition: opacity 0.7s ease-in-out; transform: none !important; }
        .cross-fade-slider .item-card:hover { transform: none !important; box-shadow: none; border-color: var(--color-border); }
        .cross-fade-slider .item-card.active { opacity: 1; z-index: 2; pointer-events: auto; }
        .slider-nav { text-align: center; margin-top: 20px; position: relative; z-index: 3; }
        .slider-dot { display: inline-block; width: 10px; height: 10px; border-radius: 50%; background-color: var(--color-border); margin: 0 5px; cursor: pointer; transition: background-color 0.3s ease, transform 0.3s ease; }
        .slider-dot.active { background-color: var(--color-accent); transform: scale(1.2); }
        @media (prefers-reduced-motion: reduce) { *, *::before, *::after { animation-duration: 0.01ms !important; animation-iteration-count: 1 !important; transition-duration: 0.01ms !important; scroll-behavior: auto !important; } .animated-container, .floating-item { opacity: 1; transform: none; transition: none; } }
        @media (max-width: 1024px) { .nav-overlay { width: 100%; } .admin-container { flex-direction: column; } .admin-sidebar { width: 100%; border-right: none; border-bottom: 1px solid var(--color-border); position: static; height: auto; } .admin-content { padding: 20px; } #services-list-container > .item-grid { display: none; } #services-list-container > .mobile-sliders-container { display: block; margin-top: 40px; } }
        @media (max-width: 768px) { h1 { font-size: 2.5rem; } }
        @media (max-width: 480px) { main { padding: 60px 15px; } h1 { font-size: 2rem; } .nav-menu { padding: 80px 20px; } .nav-menu a { font-size: 1.5rem; } }
    </style>
</head>
<body>
    <noscript><div><img src="https://mc.yandex.ru/watch/103413242" style="position:absolute; left:-9999px;" alt=""></div></noscript>
    <div id="loader"><div class="spinner"></div></div>
    <iframe id="custom-background-iframe" title="Custom Background"></iframe>
    <button class="menu-toggle" aria-label="Toggle menu"><span class="bar"></span><span class="bar"></span><span class="bar"></span></button>
    <div class="nav-overlay"><ul class="nav-menu"></ul></div>
    
    <main>
        <!-- Структура этой страницы проще: только заголовок и список услуг -->
        <section id="services-list-container">
            <h1 class="fade-in-up">Our Services</h1>
            <div class="item-grid"><!-- Карточки для десктопа --></div>
            <div class="mobile-sliders-container"><!-- Слайдеры для мобильных --></div>
        </section>
    </main>
    
    <footer class="site-footer" id="site-footer"></footer>
    <div id="admin-panel"><!-- Админ панель без изменений. Она спрятана до вызова. --></div>
    
    <script type="module">
        // --- Firebase SDK и конфигурация ---
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js';
        import { getFirestore, collection, doc, getDoc, getDocs, writeBatch, setDoc, updateDoc, deleteDoc } from 'https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore.js';
        import { getAuth, signInWithEmailAndPassword } from 'https://www.gstatic.com/firebasejs/9.15.0/firebase-auth.js';
        const firebaseConfig = { apiKey: "AIzaSyAT4dDEIDUtzP60ibjahO06P75Q6h95ZN4", authDomain: "razrabotka-b61bc.firebaseapp.com", projectId: "razrabotka-b61bc", storageBucket: "razrabotka-b61bc.firebasestorage.app", messagingSenderId: "394402564794", appId: "1:394402564794:web:f610ffb03e655c600c5083" };
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);

        // --- Глобальные переменные ---
        let siteData = {};
        const isGitHubPages = window.location.hostname.includes('github.io');
        const repoName = isGitHubPages ? window.location.pathname.split('/')[1] || '' : '';
        const basePath = isGitHubPages ? `/${repoName}` : '';
        
        // --- ВСЕ ФУНКЦИИ УЖЕ ВСТАВЛЕНЫ СЮДА ---
        async function loadData() { 
            const freshSiteData = {};
            try { 
                const collections = ['services', 'portfolio', 'blog', 'contact', 'home'];
                const dataPromises = [ getDoc(doc(db, 'home', 'content')), ...['services', 'portfolio', 'blog', 'contact'].map(col => getDocs(collection(db, col))) ];
                const [homeDoc, ...snapshots] = await Promise.all(dataPromises);
                const processDocData = (data) => { if (data && typeof data.schemaJsonLd === 'string' && data.schemaJsonLd.trim().startsWith('{')) { try { data.schemaJsonLd = JSON.parse(data.schemaJsonLd); } catch (e) { console.error('Failed to parse schemaJsonLd string:', e); data.schemaJsonLd = {}; } } return data; };
                freshSiteData.home = homeDoc.exists() ? processDocData(homeDoc.data()) : {};
                ['services', 'portfolio', 'blog', 'contact'].forEach((col, index) => { freshSiteData[col] = snapshots[index].docs.map(doc => ({ id: doc.id, ...processDocData(doc.data()) })); });
                return freshSiteData;
            } catch (error) { 
                console.error("Error loading data from Firebase:", error);
                return {};
            }
        }
        
        function getCurrentLanguage() {
            const pathParts = window.location.pathname.split('/').filter(p => p);
            const langIndex = isGitHubPages ? 1 : 0;
            return pathParts[langIndex] || 'en';
        }
        
        function renderServicesPage() {
            const lang = getCurrentLanguage();
            const langTitleMap = { en: "Our Services", ru: "Наши Услуги", ka: "ჩვენი სერვისები", ua: "Наші Послуги" };
            
            document.documentElement.lang = lang;
            const pageTitle = langTitleMap[lang] || "Our Services";
            document.title = `${pageTitle} | Digital Craft`;
            document.querySelector('#services-list-container h1').textContent = pageTitle;

            const servicesForLang = siteData.services.filter(item => item.lang === lang);
            renderCards(document.getElementById('services-list-container'), servicesForLang, 'services');
            
            initMobileSliders();
            initFloatingObservers();
        }

        function renderCards(container, items, collectionKey) {
            const desktopGrid = container.querySelector('.item-grid');
            const mobileContainer = container.querySelector('.mobile-sliders-container');
            if (!desktopGrid || !mobileContainer) return;

            const desktopItemsHTML = items.map(item => {
                const itemUrl = `${basePath}/${item.lang}/${collectionKey}/${item.urlSlug}/`;
                return `<a href="${itemUrl}" class="item-card floating-item"><div class="item-card__image" style="background-image: url('${(item.media || []).find(url => !/youtube|vimeo/.test(url)) || ''}')"></div><div class="item-card__content"><h3>${item.title}</h3><div class="card-subtitle">${item.subtitle}</div><p>${item.description}</p></div></a>`
            }).join('');
            desktopGrid.innerHTML = desktopItemsHTML;

            if (items.length > 0) {
                 const slidesHTML = items.map((item, index) => {
                    const itemUrl = `${basePath}/${item.lang}/${collectionKey}/${item.urlSlug}/`;
                    return `<a href="${itemUrl}" class="item-card ${index === 0 ? 'active' : ''}"><div class="item-card__image" style="background-image: url('${(item.media || []).find(url => !/youtube|vimeo/.test(url)) || ''}')"></div><div class="item-card__content"><h3>${item.title}</h3><div class="card-subtitle">${item.subtitle}</div><p>${item.description}</p></div></a>`
                }).join('');
                const dotsHTML = items.length > 1 ? items.map((_, index) => `<span class="slider-dot ${index === 0 ? 'active' : ''}" data-index="${index}"></span>`).join('') : '';
                mobileContainer.innerHTML = `<div class="language-slider-block"><div class="cross-fade-slider">${slidesHTML}</div><div class="slider-nav">${dotsHTML}</div></div>`;
            } else {
                mobileContainer.innerHTML = '';
            }
        }

        function renderMenu() {
            const menuEl = document.querySelector('.nav-menu');
            if (!menuEl) return;
            const homeUrl = isGitHubPages ? `${basePath}/` : '/';
            const menuItems = [
                { label: 'Home', href: homeUrl },
                { label: 'Services', href: `${homeUrl}#services` },
                { label: 'Portfolio', href: `${homeUrl}#portfolio` },
                { label: 'Blog', href: `${homeUrl}#blog` },
                { label: 'Contact', href: `${homeUrl}#contact` }
            ];
            menuEl.innerHTML = menuItems.map(item => `<li><a href="${item.href}">${item.label}</a></li>`).join('');
        }

        function applyCustomBackground(item = null) { 
            const iframe = document.getElementById('custom-background-iframe'); 
            const customCode = item?.backgroundHtml || ''; 
            if (customCode.trim() !== "") { 
                iframe.style.display = 'block'; 
                iframe.srcdoc = customCode; 
            } else { 
                iframe.style.display = 'none'; 
                iframe.srcdoc = ''; 
            } 
        }

        let floatingObserver; 
        function initFloatingObservers() { 
            if (floatingObserver) floatingObserver.disconnect(); 
            floatingObserver = createFloatingObserver(); 
            document.querySelectorAll(".item-card.floating-item").forEach(el => { 
                floatingObserver.observe(el); 
            }); 
        }

        function createFloatingObserver() { 
            return new IntersectionObserver((entries) => { 
                entries.forEach(entry => { 
                    const target = entry.target; 
                    if (entry.isIntersecting) { 
                        target.classList.add('is-visible'); 
                    } 
                }); 
            }, { threshold: 0.1 }); 
        }
        
        function initMobileSliders() {
            document.querySelectorAll('.language-slider-block').forEach(sliderBlock => {
                const slider = sliderBlock.querySelector('.cross-fade-slider'); const slides = slider.querySelectorAll('.item-card'); const nav = sliderBlock.querySelector('.slider-nav'); const dots = nav.querySelectorAll('.slider-dot');
                if (slides.length <= 1) { const activeSlide = slider.querySelector('.item-card.active'); if (activeSlide) { setTimeout(() => { if (slider.style) slider.style.height = `${activeSlide.offsetHeight}px`; }, 100); } return; }
                let currentIndex = 0; let touchStartX = 0; let autoSlideInterval;
                const updateSliderHeight = () => { const activeSlide = slider.querySelector('.item-card.active'); if (activeSlide && slider.style) { slider.style.height = `${activeSlide.offsetHeight}px`; } };
                function goToSlide(index) { currentIndex = (index + slides.length) % slides.length; slides.forEach((s, i) => s.classList.toggle('active', i === currentIndex)); dots.forEach((d, i) => d.classList.toggle('active', i === currentIndex)); updateSliderHeight(); }
                function startAutoSlide() { stopAutoSlide(); autoSlideInterval = setInterval(() => goToSlide(currentIndex + 1), 5000); }
                function stopAutoSlide() { clearInterval(autoSlideInterval); }
                updateSliderHeight(); startAutoSlide();
                nav.addEventListener('click', e => { if (e.target.matches('.slider-dot')) { stopAutoSlide(); goToSlide(parseInt(e.target.dataset.index)); startAutoSlide(); } });
                slider.addEventListener('touchstart', e => { touchStartX = e.changedTouches[0].screenX; stopAutoSlide(); }, { passive: true });
                slider.addEventListener('touchend', e => { const touchEndX = e.changedTouches[0].screenX; const swipeThreshold = 40; if (touchEndX < touchStartX - swipeThreshold) { goToSlide(currentIndex + 1); } else if (touchEndX > touchStartX + swipeThreshold) { goToSlide(currentIndex - 1); } startAutoSlide(); }, { passive: true });
            });
        }
        
        function initStaticEventListeners() { 
            const menuToggle = document.querySelector('.menu-toggle'); 
            const navOverlay = document.querySelector('.nav-overlay'); 
            if (menuToggle) {
              menuToggle.addEventListener('click', (e) => { e.stopPropagation(); menuToggle.classList.toggle('is-active'); navOverlay.classList.toggle('is-active'); }); 
            }
            if (navOverlay) {
              navOverlay.addEventListener('click', (e) => { if (e.target.closest('a') || e.target === navOverlay) { menuToggle.classList.remove('is-active'); navOverlay.classList.remove('is-active'); } }); 
            }
            const footer = document.getElementById('site-footer');
            if(footer) {
              footer.innerHTML = `© 2025 Digital Craft. All rights reserved.`;
              // Для страниц разделов админка не нужна, чтобы упростить.
              // footer.addEventListener('click', handleAdminLogin); 
            }
        }

        // --- Главная функция инициализации приложения ---
        function initApp() {
            initStaticEventListeners();
            loadData().then((freshSiteData) => {
                if (!freshSiteData || Object.keys(freshSiteData).length === 0) {
                    console.error("Failed to load any data from Firebase. Page will be empty.");
                    document.getElementById('loader').classList.add('hidden');
                    return;
                }
                siteData = freshSiteData;
                if (siteData.home) applyCustomBackground(siteData.home);

                renderMenu();
                renderServicesPage();
                
                document.getElementById('loader').classList.add('hidden');
            });
        }
        
        window.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>