<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Web Development &amp; SEO Services in Tbilisi, Georgia | Digital Craft</title>
    <link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin=""><link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&amp;display=swap" rel="stylesheet">
    <style>
        :root { --color-bg: #030409; --color-text: #FFFFFF; --color-accent: #b8d8e8; --color-card: rgba(25, 29, 45, 0.4); --color-border: rgba(184, 216, 232, 0.2); --font-main: 'Inter', sans-serif; }
        body { margin: 0; padding: 0; font-family: var(--font-main); background-color: var(--color-bg); color: var(--color-text); -webkit-font-smoothing: antialiased; overflow-x: hidden; line-height: 1.6; }
        body.nav-is-open { overflow: hidden; }
        h1, h2, h3, h4 { font-weight: 600; letter-spacing: 0.5px; }
        h2 { font-size: clamp(1.8rem, 1.5rem + 1.5vw, 2.5rem); }
        a { color: var(--color-accent); text-decoration: none; }
        #loader { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--color-bg); display: flex; justify-content: center; align-items: center; z-index: 10000; transition: opacity 0.5s ease-out; }
        #loader.hidden { opacity: 0; pointer-events: none; }
        .spinner { width: 50px; height: 50px; border: 3px solid var(--color-accent); border-radius: 50%; border-top-color: transparent; animation: spin 1s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
        #custom-background-iframe { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; border: none; z-index: 0; display: none; }
        main { position: relative; z-index: 2; max-width: 1200px; margin: 0 auto; padding: 100px 30px; }
        @keyframes fadeInUp { to { opacity: 1; transform: translateY(0); } }
        .fade-in-up { opacity: 0; transform: translateY(20px); animation: fadeInUp 1s forwards; }
        .hero-contact-list { font-size: 0.8em; list-style: none; padding-left: 0; margin-top: 25px; line-height: 1.6; }
        section { margin-bottom: 120px; perspective: 1000px; }
        .floating-item { opacity: 0; transform: translateY(60px); transition: transform 1.2s cubic-bezier(0.2, 0.8, 0.2, 1), opacity 1.2s cubic-bezier(0.2, 0.8, 0.2, 1); }
        .floating-item.is-visible { opacity: 1; transform: translateY(0); }
        .animated-container { opacity: 0; transform: translateY(20px); }
        .item-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 30px; margin-top: 40px; }
        .item-card { display: flex; flex-direction: column; background: var(--color-card); border: 1px solid var(--color-border); border-radius: 8px; overflow: hidden; transition: all 0.4s cubic-bezier(0.25, 0.8, 0.25, 1); }
        .item-card:hover { transform: translateY(-10px) scale(1.02) !important; border-color: var(--color-accent); box-shadow: 0 10px 30px rgba(184, 216, 232, 0.3); }
        .item-card__image { aspect-ratio: 4 / 3; background: linear-gradient(135deg, rgba(184, 216, 232, 0.1), rgba(25, 29, 45, 0.7)); background-size: cover; background-position: center; }
        .item-card__content { padding: 25px; }
        .item-card h3 { margin: 0 0 10px; font-size: 1.3rem; transition: color 0.3s ease-out; color: var(--color-text); }
        .item-card:hover h3 { color: var(--color-accent); }
        .item-card .card-subtitle { display: block; margin-bottom: 15px; opacity: 0.8; font-size: 0.9rem; color: var(--color-text); }
        .item-card p { margin: 0; font-size: 1.05rem; opacity: 0.9; color: var(--color-text); }
        .menu-toggle { position: fixed; top: 30px; right: 30px; z-index: 1000; background: transparent; border: none; padding: 0; cursor: pointer; width: 30px; height: 24px; display: flex; flex-direction: column; justify-content: space-between; }
        .menu-toggle .bar { background: #FFFFFF; height: 2px; width: 100%; transition: all 0.4s cubic-bezier(0.165, 0.84, 0.44, 1); transform-origin: right; }
        .menu-toggle.is-active .bar:nth-child(1) { transform: translateY(11px) rotate(-45deg); background: var(--color-accent); }
        .menu-toggle.is-active .bar:nth-child(2) { opacity: 0; }
        .menu-toggle.is-active .bar:nth-child(3) { transform: translateY(-11px) rotate(45deg); background: var(--color-accent); }
        .nav-overlay { position: fixed; top: 0; right: -100%; width: 400px; height: 100vh; background: var(--color-card); backdrop-filter: blur(10px); z-index: 999; transition: right 0.6s cubic-bezier(0.77, 0, 0.175, 1); }
        .nav-overlay.is-active { right: 0; }
        .nav-menu { padding: 100px 40px; list-style: none; margin: 0; }
        .nav-menu li { margin-bottom: 25px; opacity: 0; transform: translateX(30px); transition: all 0.4s ease-out; }
        .nav-overlay.is-active .nav-menu li { opacity: 1; transform: translateX(0); }
        .nav-menu li:nth-child(1) { transition-delay: 0.1s; } .nav-menu li:nth-child(2) { transition-delay: 0.2s; } .nav-menu li:nth-child(3) { transition-delay: 0.3s; }
        .nav-menu a { color: var(--color-text); font-size: 1.8rem; position: relative; padding-bottom: 5px; transition: color 0.3s ease-out; }
        .nav-menu a:hover { color: var(--color-accent); }
        .nav-menu a::after { content: ''; position: absolute; bottom: 0; left: 0; width: 0; height: 1px; background: var(--color-accent); transition: width 0.4s; }
        .nav-menu a:hover::after { width: 100%; }
        .hero { min-height: 90vh; display: flex; flex-direction: column; justify-content: center; }
        .hero h1 { font-size: clamp(2.5rem, 8vw, 4.5rem); margin: 0 0 20px; line-height: 1.1; font-weight: 700; text-shadow: 0 0 15px rgba(184, 216, 232, 0.4); opacity: 0; transform: translateY(20px); }
        .hero .hero-subtitle-container { opacity: 0; transform: translateY(20px); }
        .hero .hero-subtitle-container p { font-size: 1.4rem; max-width: 600px; margin-bottom: 0; }
        .site-footer { position: relative; z-index: 2; text-align: center; padding: 20px 30px; font-size: 0.9rem; color: rgba(255, 255, 255, 0.5); margin-top: -60px; cursor: pointer; user-select: none; }
        #admin-panel { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(3, 4, 9, 0.95); z-index: 10000; display: none; overflow-y: auto; backdrop-filter: blur(10px); }
        #admin-panel.active { display: block; }
        .admin-container { display: flex; min-height: 100vh; }
        .admin-sidebar { width: 250px; background: rgba(25, 29, 45, 0.8); padding: 30px; border-right: 1px solid var(--color-border); position: sticky; top: 0; height: 100vh; }
        .admin-content { flex: 1; padding: 40px; }
        .admin-tabs { list-style: none; padding: 0; }
        .admin-tabs li a { display: block; padding: 10px 0; cursor: pointer; color: var(--color-text); text-decoration: none; }
        .admin-tabs li a.active { color: var(--color-accent); font-weight: bold; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        #admin-close-btn { position: absolute; top: 25px; right: 25px; background: none; border: none; color: var(--color-text); font-size: 2rem; cursor: pointer; line-height: 1; }
        .admin-section-header { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--color-border); padding-bottom: 15px; margin-bottom: 30px; }
        .admin-item { background: var(--color-card); padding: 20px; border-radius: 8px; border: 1px solid var(--color-border); margin-bottom: 20px; }
        .admin-item-content { display: grid; grid-template-columns: 1fr; gap: 15px; }
        .admin-item-content h4 { margin-top: 15px; border-top: 1px solid var(--color-border); padding-top: 15px; color: var(--color-accent); }
        .admin-item label { font-size: 0.9rem; opacity: 0.8; margin-bottom: -10px; }
        .admin-item input, .admin-item textarea, .admin-item select { width: 100%; background: rgba(0,0,0,0.2); border: 1px solid var(--color-border); color: var(--color-text); padding: 10px; border-radius: 4px; font-family: inherit; font-size: 1rem; box-sizing: border-box; }
        .admin-item input:disabled, .admin-item textarea:disabled, .admin-item select:disabled { background: transparent; border-color: transparent; padding-left: 0; appearance: none; }
        .admin-item-actions { display: flex; gap: 10px; margin-top: 20px; justify-content: flex-end; }
        .admin-btn { padding: 8px 16px; border: 1px solid var(--color-accent); background: rgba(184, 216, 232, 0.1); color: var(--color-accent); border-radius: 4px; cursor: pointer; }
        .admin-btn.delete-btn { border-color: #e57373; color: #e57373; }
        .admin-btn.save-btn { display: none; }
        .admin-item.is-editing .edit-btn { display: none; }
        .admin-item.is-editing .save-btn { display: inline-block; }
        .mobile-sliders-container { display: none; }
        .language-slider-block { margin-bottom: 30px; }
        .cross-fade-slider { position: relative; transition: height 0.5s ease-in-out; }
        .cross-fade-slider .item-card { position: absolute; top: 0; left: 0; width: 100%; opacity: 0; z-index: 1; pointer-events: none; transition: opacity 0.7s ease-in-out; transform: none !important; }
        .cross-fade-slider .item-card.active { opacity: 1; z-index: 2; pointer-events: auto; }
        .slider-nav { text-align: center; margin-top: 20px; position: relative; z-index: 3; }
        .slider-dot { display: inline-block; width: 10px; height: 10px; border-radius: 50%; background-color: var(--color-border); margin: 0 5px; cursor: pointer; transition: background-color 0.3s ease, transform 0.3s ease; }
        .slider-dot.active { background-color: var(--color-accent); transform: scale(1.2); }
        @media (max-width: 1024px) { .nav-overlay { width: 100%; } .admin-container { flex-direction: column; } .admin-sidebar { width: 100%; position: static; height: auto; } .admin-content { padding: 20px; } section > .item-grid { display: none; } section > .mobile-sliders-container { display: block; margin-top: 40px; } }
        @media (max-width: 768px) { .hero h1 { font-size: 2.5rem; } }
        @media (max-width: 480px) { main { padding: 60px 15px; } section { margin-bottom: 60px; } .hero h1 { font-size: 2rem; } .nav-menu { padding: 80px 20px; } .nav-menu a { font-size: 1.5rem; } }
    </style>
</head>
<body>
    <div id="loader"><div class="spinner"></div></div>
    <iframe id="custom-background-iframe" title="Custom Background"></iframe>
    <button class="menu-toggle" aria-label="Toggle menu"><span class="bar"></span><span class="bar"></span><span class="bar"></span></button>
    <div class="nav-overlay"><ul class="nav-menu"></ul></div>

    <main>
        <div id="hero" class="hero"><h1>Loading...</h1></div>
        <section id="services"><div class="animated-container"><h2>Our Services</h2></div><div class="item-grid"></div><div class="mobile-sliders-container"></div></section>
        <section id="portfolio"><div class="animated-container"><h2>Our Work</h2></div><div class="item-grid"></div><div class="mobile-sliders-container"></div></section>
        <section id="blog"><div class="animated-container"><h2>Latest Insights</h2></div><div class="item-grid"></div><div class="mobile-sliders-container"></div></section>
        <section id="contact"><div class="animated-container"><h2>Get in Touch</h2></div><div class="item-grid"></div><div class="mobile-sliders-container"></div></section>
    </main>
    
    <footer class="site-footer"></footer>
    
    <div id="admin-panel">
        <div class="admin-container">
            <div class="admin-sidebar">
                <h3>Admin Panel</h3>
                <ul class="admin-tabs">
                    <li><a href="#admin-home" class="admin-tab-link active" data-tab="home">Home Page</a></li>
                    <li><a href="#admin-services" class="admin-tab-link" data-tab="services">Services</a></li>
                    <li><a href="#admin-portfolio" class="admin-tab-link" data-tab="portfolio">Portfolio</a></li>
                    <li><a href="#admin-blog" class="admin-tab-link" data-tab="blog">Blog</a></li>
                    <li><a href="#admin-contact" class="admin-tab-link" data-tab="contact">Contact</a></li>
                </ul>
            </div>
            <div class="admin-content">
                <button id="admin-close-btn" title="Close Admin Panel">×</button>
                <div class="tab-content active" data-tab-content="home"></div>
                <div class="tab-content" data-tab-content="services"></div>
                <div class="tab-content" data-tab-content="portfolio"></div>
                <div class="tab-content" data-tab-content="blog"></div>
                <div class="tab-content" data-tab-content="contact"></div>
            </div>
        </div>
    </div>
    
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js';
        import { getFirestore, collection, doc, getDoc, getDocs, writeBatch, setDoc, updateDoc, deleteDoc } from 'https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore.js';
        import { getAuth, signInWithEmailAndPassword } from 'https://www.gstatic.com/firebasejs/9.15.0/firebase-auth.js';
        
        const firebaseConfig = { apiKey: "AIzaSyAT4dDEIDUtzP60ibjahO06P75Q6h95ZN4", authDomain: "razrabotka-b61bc.firebaseapp.com", projectId: "razrabotka-b61bc", storageBucket: "razrabotka-b61bc.firebasestorage.app", messagingSenderId: "394402564794", appId: "1:394402564794:web:f610ffb03e655c600c5083" };
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        let siteData = {};

        async function loadAllData() {
            const freshData = {};
            try {
                const collections = ['services', 'portfolio', 'blog', 'contact'];
                const dataPromises = [getDoc(doc(db, 'home', 'content')), ...collections.map(col => getDocs(collection(db, col)))];
                const [homeDoc, ...snapshots] = await Promise.all(dataPromises);
                const processDocData = (data) => { if (data && typeof data.schemaJsonLd === 'string' && data.schemaJsonLd.trim().startsWith('{')) { try { data.schemaJsonLd = JSON.parse(data.schemaJsonLd); } catch (e) { data.schemaJsonLd = {}; } } return data; };
                freshData.home = homeDoc.exists() ? processDocData(homeDoc.data()) : {};
                collections.forEach((col, index) => { freshData[col] = snapshots[index].docs.map(doc => ({ id: doc.id, ...processDocData(doc.data()) })); });
                return freshData;
            } catch (error) { console.error("Error loading data from Firebase:", error); document.querySelector('main').innerHTML = `<h1>Error</h1><p>Could not load data. Please check your connection.</p>`; return {}; }
        }

        function renderHomePageContent(data) {
            siteData = data;
            updateMetaTags(siteData.home);
            applyCustomBackground(siteData.home);
            renderHero();
            renderSection('services', 'Our Services', siteData.services);
            renderSection('portfolio', 'Our Work', siteData.portfolio);
            renderSection('blog', 'Latest Insights', siteData.blog);
            renderSection('contact', 'Get in Touch', siteData.contact);
            initMobileSliders();
            initHomePageObservers();
            initFloatingObservers();
        }

        function renderHero() {
            const heroContainer = document.getElementById('hero'); if (!heroContainer || !siteData.home) return;
            const { h1, subtitle } = siteData.home; let heroContent = `<h1>${h1 || ''}</h1>`;
            if (subtitle) { const parts = subtitle.split(/\n\s*\n/); const introText = parts[0] || ''; const contactLines = parts.length > 1 ? parts.slice(1).join('\n').split('\n').filter(line => line.trim()) : []; heroContent += `<div class="hero-subtitle-container"><p>${introText}</p>`; if (contactLines.length > 0) { heroContent += `<ul class="hero-contact-list">${contactLines.map(line => `<li>${line}</li>`).join('')}</ul>`; } heroContent += `</div>`; }
            heroContainer.innerHTML = heroContent;
        }

        function renderSection(key, title, items) {
            const section = document.getElementById(key); if (!section) return;
            const itemsFromDb = items || [];
            const desktopItemsHTML = itemsFromDb.map(item => `<a href="/${item.lang}/${key}/${item.urlSlug}/" class="item-card floating-item"><div class="item-card__image" style="background-image: url('${(item.media || []).find(url => !/youtube|vimeo/.test(url)) || ''}')"></div><div class="item-card__content"><h3>${item.title}</h3><div class="card-subtitle">${item.subtitle}</div><p>${item.description}</p></div></a>`).join('');
            section.querySelector('.item-grid').innerHTML = desktopItemsHTML;
            const langOrder = ['en', 'ka', 'ua', 'ru'];
            const itemsByLang = {};
            itemsFromDb.forEach(item => { (itemsByLang[item.lang] = itemsByLang[item.lang] || []).push(item); });
            const mobileSlidersHTML = langOrder.map(lang => {
                const langItems = itemsByLang[lang]; if (!langItems || langItems.length === 0) return '';
                const slidesHTML = langItems.map((item, index) => `<a href="/${item.lang}/${key}/${item.urlSlug}/" class="item-card ${index === 0 ? 'active' : ''}"><div class="item-card__image" style="background-image: url('${(item.media || []).find(url => !/youtube|vimeo/.test(url)) || ''}')"></div><div class="item-card__content"><h3>${item.title}</h3><div class="card-subtitle">${item.subtitle}</div><p>${item.description}</p></div></a>`).join('');
                const dotsHTML = langItems.length > 1 ? langItems.map((_, index) => `<span class="slider-dot ${index === 0 ? 'active' : ''}" data-index="${index}"></span>`).join('') : '';
                return `<div class="language-slider-block"><div class="cross-fade-slider">${slidesHTML}</div><div class="slider-nav">${dotsHTML}</div></div>`;
            }).join('');
            section.querySelector('.mobile-sliders-container').innerHTML = mobileSlidersHTML;
        }

        function updateMetaTags(data) {
            document.querySelectorAll('meta[name="description"], meta[property^="og:"], script[type="application/ld+json"], link[rel="canonical"]').forEach(el => el.remove());
            document.title = data.seoTitle || "Digital Craft"; document.documentElement.lang = data.lang || 'en';
            const createMeta = (attr, key, value) => { if (value) { const meta = document.createElement('meta'); meta.setAttribute(attr, key); meta.content = value; document.head.appendChild(meta); } };
            createMeta('name', 'description', data.metaDescription); createMeta('property', 'og:title', data.ogTitle || data.seoTitle); createMeta('property', 'og:description', data.ogDescription || data.metaDescription);
            if (data.media && data.media[0]) createMeta('property', 'og:image', data.media[0]);
            const canonical = document.createElement('link'); canonical.rel = 'canonical'; canonical.href = window.location.origin + window.location.pathname; document.head.appendChild(canonical);
            if (data.schemaJsonLd && typeof data.schemaJsonLd === 'object' && Object.keys(data.schemaJsonLd).length > 0) { const script = document.createElement('script'); script.type = 'application/ld+json'; script.textContent = JSON.stringify(data.schemaJsonLd); document.head.appendChild(script); }
        }
        
        function applyCustomBackground(item = {}) { const iframe = document.getElementById('custom-background-iframe'); const customCode = item?.backgroundHtml || ''; if (customCode.trim()) { iframe.style.display = 'block'; iframe.srcdoc = customCode; } else { iframe.style.display = 'none'; iframe.srcdoc = ''; } }
        
        function renderMenu() {
            const menuEl = document.querySelector('.nav-menu');
            // FIX: Ссылки на секции теперь ведут на /index.html#... для большей надежности в MPA
            const menuItems = [ { label: 'Home', href: `/` }, { label: 'Services', href: `/index.html#services` }, { label: 'Portfolio', href: `/index.html#portfolio` }, { label: 'Blog', href: `/index.html#blog` }, { label: 'Contact', href: `/index.html#contact` } ];
            menuEl.innerHTML = menuItems.map(item => `<li><a href="${item.href}">${item.label}</a></li>`).join('');
        }
        
        let floatingObserver;
        function initFloatingObservers() {
            if (floatingObserver) floatingObserver.disconnect();
            // FIX: Анимации теперь срабатывают каждый раз при появлении в поле зрения
            floatingObserver = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    entry.target.classList.toggle('is-visible', entry.isIntersecting);
                });
            }, { threshold: 0.1 });
            document.querySelectorAll(".item-grid .item-card.floating-item").forEach(el => floatingObserver.observe(el));
        }

        let homePageObserver;
        function initHomePageObservers() {
            if (homePageObserver) homePageObserver.disconnect();
            // FIX: Анимации для Hero и заголовков секций теперь срабатывают каждый раз
            homePageObserver = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    const animatedElements = entry.target.id === 'hero' ? entry.target.querySelectorAll('h1, .hero-subtitle-container') : entry.target.querySelectorAll('.animated-container');
                    if (entry.isIntersecting) {
                        animatedElements.forEach((el, index) => {
                            const delay = entry.target.id === 'hero' ? 0.3 + index * 0.2 : 0;
                            el.style.animationDelay = `${delay}s`;
                            el.classList.add('fade-in-up');
                        });
                    } else {
                         animatedElements.forEach(el => {
                            el.classList.remove('fade-in-up');
                        });
                    }
                });
            }, { threshold: 0.1 });
            document.querySelectorAll('#hero, #services, #portfolio, #blog, #contact').forEach(section => { if(section) homePageObserver.observe(section); });
        }

        function initMobileSliders() {
            document.querySelectorAll('.language-slider-block').forEach(sliderBlock => {
                const slider = sliderBlock.querySelector('.cross-fade-slider');
                if (!slider) return;
                const slides = slider.querySelectorAll('.item-card');
                const nav = sliderBlock.querySelector('.slider-nav');
                const dots = nav.querySelectorAll('.slider-dot');
                if (slides.length <= 1) { const activeSlide = slider.querySelector('.item-card.active'); if (activeSlide) { setTimeout(() => { slider.style.height = `${activeSlide.offsetHeight}px`; }, 100); } return; }
                
                let currentIndex = 0; let autoSlideInterval; let touchStartX = 0;

                const updateSliderHeight = () => { const activeSlide = slider.querySelector('.item-card.active'); if (activeSlide) { slider.style.height = `${activeSlide.offsetHeight}px`; } };
                function goToSlide(index) { currentIndex = (index + slides.length) % slides.length; slides.forEach((s, i) => s.classList.toggle('active', i === currentIndex)); dots.forEach((d, i) => d.classList.toggle('active', i === currentIndex)); updateSliderHeight(); }
                function startAutoSlide() { stopAutoSlide(); autoSlideInterval = setInterval(() => goToSlide(currentIndex + 1), 5000); }
                function stopAutoSlide() { clearInterval(autoSlideInterval); }
                
                updateSliderHeight(); startAutoSlide();
                
                nav.addEventListener('click', e => { if (e.target.matches('.slider-dot')) { stopAutoSlide(); goToSlide(parseInt(e.target.dataset.index)); startAutoSlide(); } });
                
                // FIX: Добавлена логика свайпа
                slider.addEventListener('touchstart', e => {
                    touchStartX = e.changedTouches[0].screenX;
                    stopAutoSlide();
                }, { passive: true });

                slider.addEventListener('touchend', e => {
                    const touchEndX = e.changedTouches[0].screenX;
                    if (touchStartX - touchEndX > 50) { // Свайп влево
                        goToSlide(currentIndex + 1);
                    } else if (touchEndX - touchStartX > 50) { // Свайп вправо
                        goToSlide(currentIndex - 1);
                    }
                    startAutoSlide();
                }, { passive: true });
            });
        }
        
        function renderAdminPanel(data) { siteData = data; renderAdminHome(); renderAdminSection('services'); renderAdminSection('portfolio'); renderAdminSection('blog'); renderAdminSection('contact'); }
        function renderAdminHome() {
            const container = document.querySelector('.tab-content[data-tab-content="home"]'); if(!container || !siteData.home) return; const data = siteData.home;
            container.innerHTML = `<div class="admin-section-header"><h2>Home Page Content & SEO</h2></div><div class="admin-item" id="admin-home-item"><div class="admin-item-content"><h4>Visible Content</h4><label for="home-h1">Main Header (H1)</label><input type="text" id="home-h1" value="${data.h1 || ''}" disabled><label for="home-subtitle">Subtitle</label><textarea id="home-subtitle" rows="3" disabled>${data.subtitle || ''}</textarea><h4>Critical SEO</h4><label for="home-lang">Language (e.g., en, ru)</label><input type="text" id="home-lang" value="${data.lang || 'en'}" disabled><label for="home-seoTitle">SEO Title Tag</label><input type="text" id="home-seoTitle" value="${data.seoTitle || ''}" disabled><label for="home-metaDescription">Meta Description</label><textarea id="home-metaDescription" rows="3" disabled>${data.metaDescription || ''}</textarea><h4>Schema.org</h4><label>JSON-LD Code</label><textarea id="home-schemaJsonLd" rows="8" disabled>${typeof data.schemaJsonLd === 'object' ? JSON.stringify(data.schemaJsonLd, null, 2) : data.schemaJsonLd || '{}'}</textarea><h4>Open Graph</h4><label for="home-ogTitle">OG Title</label><input type="text" id="home-ogTitle" value="${data.ogTitle || ''}" disabled><label for="home-ogDescription">OG Description</label><textarea id="home-ogDescription" rows="3" disabled>${data.ogDescription || ''}</textarea><label for="home-ogImage">OG Image URL</label><input type="text" id="home-ogImage" value="${data.ogImage || ''}" disabled><h4>Custom Background</h4><label for="home-backgroundHtml">Custom Background HTML/JS/CSS</label><textarea id="home-backgroundHtml" rows="10" disabled>${data.backgroundHtml || ''}</textarea></div><div class="admin-item-actions"><button class="admin-btn edit-btn" data-action="edit-home">Edit</button><button class="admin-btn save-btn" data-action="save-home">Save</button></div></div>`;
        }
        function renderAdminSection(key) {
            const container = document.querySelector(`.tab-content[data-tab-content="${key}"]`); if(!container) return; const title = key.charAt(0).toUpperCase() + key.slice(1);
            const itemsHTML = (siteData[key] || []).map(item => `<div class="admin-item" data-id="${item.id}" data-key="${key}"><div class="admin-item-content"><h4>Card Content</h4><label>Title</label><input type="text" class="admin-input-title" value="${item.title || ''}" disabled><label>Subtitle</label><input type="text" class="admin-input-subtitle" value="${item.subtitle || ''}" disabled><label>Description</label><textarea class="admin-input-description" rows="3" disabled>${item.description || ''}</textarea><h4>Detailed Page</h4><label>Language</label><select class="admin-input-lang" disabled><option value="en" ${item.lang === 'en' ? 'selected' : ''}>English</option><option value="ru" ${item.lang === 'ru' ? 'selected' : ''}>Русский</option><option value="ka" ${item.lang === 'ka' ? 'selected' : ''}>Georgian</option><option value="ua" ${item.lang === 'ua' ? 'selected' : ''}>Ukrainian</option></select><label>URL Slug</label><input type="text" class="admin-input-urlSlug" value="${item.urlSlug || ''}" disabled><label>H1</label><input type="text" class="admin-input-h1" value="${item.h1 || ''}" disabled><label>Price</label><input type="text" class="admin-input-price" value="${item.price || ''}" disabled><label>Main Content</label><textarea class="admin-input-mainContent" rows="8" disabled>${item.mainContent || ''}</textarea><label>Media URLs</label><textarea class="admin-input-media" rows="4" disabled>${(item.media || []).join('\n')}</textarea><label>Image Alt Text</label><input type="text" class="admin-input-mainImageAlt" value="${item.mainImageAlt || ''}" disabled><h4>SEO</h4><label>SEO Title</label><input type="text" class="admin-input-seoTitle" value="${item.seoTitle || ''}" disabled><label>Meta Description</label><textarea class="admin-input-metaDescription" rows="3" disabled>${item.metaDescription || ''}</textarea><label>Schema.org JSON-LD</label><textarea class="admin-input-schemaJsonLd" rows="5" disabled>${typeof item.schemaJsonLd === 'object' ? JSON.stringify(item.schemaJsonLd, null, 2) : item.schemaJsonLd || '{}'}</textarea><h4>Custom Background</h4><label>Custom BG HTML</label><textarea class="admin-input-backgroundHtml" rows="6" disabled>${item.backgroundHtml || ''}</textarea></div><div class="admin-item-actions"><button class="admin-btn edit-btn" data-action="edit">Edit</button><button class="admin-btn save-btn" data-action="save">Save</button><button class="admin-btn delete-btn" data-action="delete">Delete</button></div></div>`).join('');
            container.innerHTML = `<div class="admin-section-header"><h2>Manage ${title}</h2><button class="admin-btn" data-action="add" data-key="${key}">+ Add New</button></div>${itemsHTML}`;
        }
        async function handleAdminActions(e) {
            const target = e.target; const action = target.dataset.action; if (!action) return; const itemEl = target.closest('.admin-item');
            const setEditingState = (el, isEditing) => { el.classList.toggle('is-editing', isEditing); el.querySelectorAll('input, textarea, select').forEach(input => input.disabled = !isEditing); };
            try {
                if (action === 'edit-home' || action === 'edit') { setEditingState(itemEl, true); return; }
                if (action === 'save-home') {
                    setEditingState(itemEl, false); let schemaValue; try { schemaValue = JSON.parse(itemEl.querySelector('#home-schemaJsonLd').value); } catch(err) { alert("Error: Invalid JSON in Schema field."); return; }
                    const updatedData = { h1: itemEl.querySelector('#home-h1').value, subtitle: itemEl.querySelector('#home-subtitle').value, lang: itemEl.querySelector('#home-lang').value, seoTitle: itemEl.querySelector('#home-seoTitle').value, metaDescription: itemEl.querySelector('#home-metaDescription').value, schemaJsonLd: schemaValue, ogTitle: itemEl.querySelector('#home-ogTitle').value, ogDescription: itemEl.querySelector('#home-ogDescription').value, ogImage: itemEl.querySelector('#home-ogImage').value, backgroundHtml: itemEl.querySelector('#home-backgroundHtml').value, };
                    await updateDoc(doc(db, 'home', 'content'), updatedData); alert('Home page updated!'); location.reload(); return;
                }
                const key = target.dataset.key || itemEl.dataset.key; const id = itemEl ? itemEl.dataset.id : null;
                if (action === 'save') {
                    setEditingState(itemEl, false); let schemaValue; try { schemaValue = JSON.parse(itemEl.querySelector('.admin-input-schemaJsonLd').value); } catch(err) { alert("Error: Invalid JSON in Schema field."); return; }
                    const updatedData = { lang: itemEl.querySelector('.admin-input-lang').value, title: itemEl.querySelector('.admin-input-title').value, subtitle: itemEl.querySelector('.admin-input-subtitle').value, description: itemEl.querySelector('.admin-input-description').value, urlSlug: itemEl.querySelector('.admin-input-urlSlug').value.trim(), h1: itemEl.querySelector('.admin-input-h1').value, price: itemEl.querySelector('.admin-input-price').value, mainContent: itemEl.querySelector('.admin-input-mainContent').value, media: itemEl.querySelector('.admin-input-media').value.split('\n').map(s => s.trim()).filter(Boolean), mainImageAlt: itemEl.querySelector('.admin-input-mainImageAlt').value, seoTitle: itemEl.querySelector('.admin-input-seoTitle').value, metaDescription: itemEl.querySelector('.admin-input-metaDescription').value, schemaJsonLd: schemaValue, backgroundHtml: itemEl.querySelector('.admin-input-backgroundHtml').value };
                    await updateDoc(doc(db, key, id), updatedData); alert('Item saved!'); location.reload();
                } else if (action === 'delete') { if (confirm('Are you sure?')) { await deleteDoc(doc(db, key, id)); alert('Item deleted!'); location.reload(); }
                } else if (action === 'add') {
                    const newId = `${key.slice(0, -1)}-${Date.now()}`; const newTitle = 'New Item Title'; const newSlug = newTitle.toLowerCase().replace(/\s+/g, '-');
                    const newItemData = { lang: 'en', urlSlug: newSlug, title: newTitle, subtitle: 'New Subtitle', description: 'A short description.', h1: newTitle, mainContent: 'Full content.', price: '', media: [], mainImageAlt: '', seoTitle: newTitle, metaDescription: '', schemaJsonLd: {}, backgroundHtml: '' };
                    await setDoc(doc(db, key, newId), newItemData); alert('New item added.'); location.reload();
                }
            } catch(error) { console.error("Admin action failed:", error); alert("An error occurred."); }
        }

        function initApp() {
            renderMenu();
            const menuToggle = document.querySelector('.menu-toggle'); const navOverlay = document.querySelector('.nav-overlay');
            menuToggle.addEventListener('click', () => { menuToggle.classList.toggle('is-active'); navOverlay.classList.toggle('is-active'); document.body.classList.toggle('nav-is-open'); });
            navOverlay.addEventListener('click', () => { menuToggle.classList.remove('is-active'); navOverlay.classList.remove('is-active'); document.body.classList.remove('nav-is-open'); });
            document.querySelector('.site-footer').innerHTML = `© ${new Date().getFullYear()} Digital Craft. All rights reserved.`;
            
            const adminPanel = document.getElementById('admin-panel');
            const adminTabs = document.querySelector('.admin-tabs');
            function switchAdminTab(tabName) {
                adminPanel.querySelectorAll('.admin-tab-link').forEach(el => el.classList.remove('active'));
                adminPanel.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
                const activeLink = adminPanel.querySelector(`.admin-tab-link[data-tab="${tabName}"]`);
                const activeContent = adminPanel.querySelector(`.tab-content[data-tab-content="${tabName}"]`);
                if (activeLink) activeLink.classList.add('active');
                if (activeContent) activeContent.classList.add('active');
            }
            adminTabs.addEventListener('click', e => {
                const link = e.target.closest('.admin-tab-link');
                if (link) { e.preventDefault(); const tabName = link.dataset.tab; history.pushState(null, '', `#admin-${tabName}`); switchAdminTab(tabName); }
            });
            async function openAdminPanel() {
                adminPanel.classList.add('active');
                const hash = window.location.hash; let tabToOpen = 'home';
                if (hash.startsWith('#admin-')) { tabToOpen = hash.substring(7); }
                switchAdminTab(tabToOpen);
            }
            document.querySelector('.site-footer').addEventListener('click', async () => {
                if (auth.currentUser) { openAdminPanel(); return; }
                const email = prompt("Enter admin email:"); if (!email) return;
                const password = prompt("Enter admin password:"); if (!password) return;
                try { await signInWithEmailAndPassword(auth, email, password); openAdminPanel(); } catch (error) { alert("Login failed."); }
            });
            document.getElementById('admin-close-btn').addEventListener('click', () => { adminPanel.classList.remove('active'); history.pushState("", document.title, window.location.pathname + window.location.search); });
            document.querySelector('.admin-content').addEventListener('click', handleAdminActions);

            loadAllData().then(data => {
                renderHomePageContent(data);
                renderAdminPanel(data);
                document.getElementById('loader').classList.add('hidden');
            });
        }
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
    <script src="/metrika.js" defer></script>
</body>
</html>